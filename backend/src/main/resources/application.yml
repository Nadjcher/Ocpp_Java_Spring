# =============================================================================
# EVSE Simulator - Configuration par défaut
# =============================================================================

server:
  port: 8887
  tomcat:
    max-connections: 30000
    accept-count: 1000
    threads:
      max: 500
      min-spare: 50
    connection-timeout: 20000
  servlet:
    context-path: /

spring:
  application:
    name: evse-simulator
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:dev}
  jackson:
    serialization:
      write-dates-as-timestamps: false
      indent-output: true
      fail-on-empty-beans: false
    deserialization:
      fail-on-unknown-properties: false
    default-property-inclusion: non_null
    date-format: yyyy-MM-dd'T'HH:mm:ss.SSS'Z'
    time-zone: UTC
  mvc:
    async:
      request-timeout: 60000

# =============================================================================
# WebSocket Configuration
# =============================================================================
websocket:
  allowed-origins:
    - "http://localhost:3000"
    - "http://localhost:3002"
    - "http://localhost:8887"
    - "http://127.0.0.1:3000"
    - "http://127.0.0.1:3002"
  stomp:
    endpoint: /ws
    broker:
      - /topic
      - /queue
    application-destination-prefix: /app
  message:
    buffer-size: 65536

# =============================================================================
# OCPP Configuration
# =============================================================================
ocpp:
  version: "1.6"
  heartbeat-interval: 30000
  meter-values-interval: 10000
  default-url: ws://localhost:8887/ocpp
  connection-timeout: 10000
  reconnect-delay: 5000
  max-reconnect-attempts: 5
  message:
    max-size: 65536

# =============================================================================
# Metrics Configuration
# =============================================================================
metrics:
  # Intervalle de diffusion des métriques (ms)
  broadcast-interval: 1000
  # Nombre maximum d'échantillons de latence conservés
  latency-samples: 1000

# =============================================================================
# Load Test Configuration
# =============================================================================
loadtest:
  # Nombre maximum de sessions pour les tests de charge
  max-sessions: 25000
  # Taille du pool de threads pour les tests de charge
  thread-pool-size: 10

# =============================================================================
# Performance Configuration (Legacy - use metrics/loadtest instead)
# =============================================================================
performance:
  max-sessions: ${loadtest.max-sessions}
  websocket-pool-size: 100
  metrics-interval: ${metrics.broadcast-interval}
  batch-size: 100
  async:
    core-pool-size: 50
    max-pool-size: 200
    queue-capacity: 10000
    thread-name-prefix: "evse-async-"

# =============================================================================
# Data Storage Configuration
# =============================================================================
data:
  path: ./data
  vehicles-file: ${data.path}/vehicles.json
  sessions-file: ${data.path}/sessions.json
  tnr-scenarios-file: ${data.path}/tnr-scenarios.json
  auto-save-interval: 30000
  max-log-entries: 500
  max-chart-points: 500

# =============================================================================
# Actuator / Metrics
# =============================================================================
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
      base-path: /actuator
  endpoint:
    health:
      show-details: when-authorized
  metrics:
    export:
      prometheus:
        enabled: true
    tags:
      application: ${spring.application.name}

# =============================================================================
# OpenAPI / Swagger
# =============================================================================
springdoc:
  api-docs:
    path: /v3/api-docs
    enabled: true
  swagger-ui:
    path: /swagger-ui.html
    enabled: true
    operations-sorter: alpha
    tags-sorter: alpha
  show-actuator: false

# =============================================================================
# Logging
# =============================================================================
logging:
  level:
    root: INFO
    com.evse.simulator: DEBUG
    org.springframework.web.socket: INFO
    org.springframework.messaging: INFO
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"
  file:
    name: logs/evse-simulator.log
    max-size: 10MB
    max-history: 30
